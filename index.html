<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Allston Car Wash — Job Application</title>

  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --text:#0f172a; --muted:#475569;
      --border:#e2e8f0; --accent:#2563eb;
    }
    *{ box-sizing:border-box; }
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      margin:0; background:var(--bg); color:var(--text);
    }
    .header{ padding:26px 18px; background:linear-gradient(135deg,#0f172a,#1d4ed8); color:#fff; }
    .brand{ max-width:920px; margin:0 auto; }
    .brand h1{ margin:0; font-size:26px; }
    .brand p{ margin:8px 0 0 0; opacity:.92; font-size:14px; line-height:1.35; }
    .wrap{ max-width:920px; margin:16px auto 50px auto; padding:0 14px; }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:14px;
      padding:16px; box-shadow:0 10px 25px rgba(15,23,42,.06);
    }
    .section-title{ margin:18px 0 10px 0; font-size:18px; }
    .grid{ display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width:720px){ .grid.two{ grid-template-columns:1fr 1fr; } }
    label{ display:block; font-weight:700; font-size:13px; margin-bottom:6px; }
    input, select, textarea{
      width:100%; padding:12px; border-radius:10px; border:1px solid var(--border);
      background:#fff; font-size:15px; outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color:rgba(37,99,235,.55); box-shadow:0 0 0 4px rgba(37,99,235,.15);
    }
    .row{ display:flex; gap:10px; align-items:flex-start; }
    .terms{ font-size:13px; color:var(--muted); line-height:1.35; }
    canvas{
      width:100%; max-width:560px; height:180px; border:1px dashed #94a3b8;
      border-radius:12px; background:#fff; touch-action:none; display:block;
    }
    .btn{
      width:100%; padding:12px; border:0; border-radius:12px;
      font-size:16px; font-weight:800; cursor:pointer;
    }
    .btn-primary{ background:var(--accent); color:#fff; margin-top:14px; }
    .btn-ghost{ background:#eef2ff; color:#1d4ed8; margin-top:10px; }
    .hint{ margin-top:10px; font-size:12px; color:var(--muted); }
    .status{ margin-top:12px; font-size:13px; color:var(--muted); }
  </style>
</head>

<body>
  <div class="header">
    <div class="brand">
      <h1>Allston Car Wash</h1>
      <p>Job Application Form • Please complete all required fields. Terms acceptance and a signature are required.</p>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <h2 class="section-title">Applicant Information</h2>

      <div class="grid two">
        <div>
          <label for="name">Full Name *</label>
          <input id="name" type="text" placeholder="First and last name" />
        </div>
        <div>
          <label for="email">Email *</label>
          <input id="email" type="email" placeholder="example@email.com" />
        </div>
        <div>
          <label for="phone">Phone *</label>
          <input id="phone" type="tel" placeholder="(###) ###-####" />
        </div>
        <div>
          <label for="position">Position Applying For *</label>
          <select id="position">
            <option value="">Select one</option>
            <option>Cashier</option>
            <option>Sales</option>
            <option>Driver</option>
            <option>Other</option>
          </select>
        </div>
      </div>

      <h2 class="section-title">Address</h2>
      <div class="grid two">
        <div>
          <label for="street">Street Address *</label>
          <input id="street" type="text" placeholder="Street address" />
        </div>
        <div>
          <label for="city">City *</label>
          <input id="city" type="text" placeholder="City" />
        </div>
        <div>
          <label for="state">State *</label>
          <input id="state" type="text" placeholder="MA" />
        </div>
        <div>
          <label for="zip">Zip Code *</label>
          <input id="zip" type="text" placeholder="#####"/>
        </div>
      </div>

      <h2 class="section-title">Work Eligibility & Availability</h2>
      <div class="grid two">
        <div>
          <label for="eligible">Legally eligible to work in the U.S.? *</label>
          <select id="eligible">
            <option value="">Select one</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
        <div>
          <label for="startDate">Available Start Date *</label>
          <input id="startDate" type="date" />
        </div>
        <div>
          <label for="under18">If under 18 (if required), can you provide a work permit?</label>
          <select id="under18">
            <option value="">Select one</option>
            <option>Yes</option>
            <option>No</option>
            <option>Not applicable</option>
          </select>
        </div>
        <div>
          <label for="employmentType">Type of employment desired *</label>
          <select id="employmentType">
            <option value="">Select one</option>
            <option>Full time</option>
            <option>Part time</option>
            <option>Seasonal</option>
          </select>
        </div>

        <div>
          <label for="hoursPerWeek">Hours per week you are willing to work *</label>
          <input id="hoursPerWeek" type="number" min="0" placeholder="e.g., 40" />
        </div>
        <div>
          <label for="overtime">Will you work overtime if required? *</label>
          <select id="overtime">
            <option value="">Select one</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px;">
        <label>Days available to work *</label>
        <div class="grid two">
          <label class="row"><input type="checkbox" class="day" value="Monday" style="width:auto;margin-top:2px;"> Monday</label>
          <label class="row"><input type="checkbox" class="day" value="Tuesday" style="width:auto;margin-top:2px;"> Tuesday</label>
          <label class="row"><input type="checkbox" class="day" value="Wednesday" style="width:auto;margin-top:2px;"> Wednesday</label>
          <label class="row"><input type="checkbox" class="day" value="Thursday" style="width:auto;margin-top:2px;"> Thursday</label>
          <label class="row"><input type="checkbox" class="day" value="Friday" style="width:auto;margin-top:2px;"> Friday</label>
          <label class="row"><input type="checkbox" class="day" value="Saturday" style="width:auto;margin-top:2px;"> Saturday</label>
          <label class="row"><input type="checkbox" class="day" value="Sunday" style="width:auto;margin-top:2px;"> Sunday</label>
        </div>
      </div>

      <h2 class="section-title">Driving (if applicable)</h2>
      <div class="grid two">
        <div>
          <label for="stick">Can you drive a standard (stick shift) car?</label>
          <select id="stick">
            <option value="">Select one</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
        <div>
          <label for="license">Do you have a valid U.S. Driver’s License?</label>
          <select id="license">
            <option value="">Select one</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
      </div>

      <h2 class="section-title">Employment History (Most Recent)</h2>
      <div class="grid two">
        <div>
          <label for="company">Company Name</label>
          <input id="company" type="text" placeholder="Company" />
        </div>
        <div>
          <label for="jobTitle">Job Title</label>
          <input id="jobTitle" type="text" placeholder="Job title" />
        </div>
        <div>
          <label for="companyPhone">Company Phone</label>
          <input id="companyPhone" type="tel" placeholder="(###) ###-####" />
        </div>
        <div>
          <label for="contactRef">May we contact for reference?</label>
          <select id="contactRef">
            <option value="">Select one</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px;">
        <label for="notes">Additional Notes (optional)</label>
        <textarea id="notes" rows="4" placeholder="Anything you want us to know..."></textarea>
      </div>

      <div style="margin-top:14px;">
        <div class="row">
          <input type="checkbox" id="terms" style="width:auto; margin-top:2px;">
          <div class="terms">
            <strong>I agree</strong> to the Terms & Conditions and confirm the information provided is accurate.
          </div>
        </div>
      </div>

      <div style="margin-top:14px;">
        <label>Signature *</label>
        <canvas id="signature"></canvas>
        <button class="btn btn-ghost" type="button" onclick="clearSig()">Clear Signature</button>
        <div class="hint">Tip: Use your finger or Apple Pencil to sign.</div>
      </div>

      <button class="btn btn-primary" type="button" onclick="submitForm()">Submit Application</button>
      <div id="status" class="status"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script>
    const canvas = document.getElementById('signature');
    const statusEl = document.getElementById('status');
    const signaturePad = new SignaturePad(canvas);

    function resizeCanvas(){
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * ratio;
      canvas.height = rect.height * ratio;
      canvas.getContext("2d").scale(ratio, ratio);
      signaturePad.clear();
    }
    window.addEventListener('resize', resizeCanvas);
    setTimeout(resizeCanvas, 50);

    function clearSig(){ signaturePad.clear(); }

    function getDays(){
      return Array.from(document.querySelectorAll('.day:checked')).map(x => x.value);
    }

    async function submitForm(){
      statusEl.textContent = "";

      const payload = {
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        position: document.getElementById('position').value,
        street: document.getElementById('street').value.trim(),
        city: document.getElementById('city').value.trim(),
        state: document.getElementById('state').value.trim(),
        zip: document.getElementById('zip').value.trim(),
        eligible: document.getElementById('eligible').value,
        startDate: document.getElementById('startDate').value,
        under18: document.getElementById('under18').value,
        employmentType: document.getElementById('employmentType').value,
        hoursPerWeek: document.getElementById('hoursPerWeek').value,
        overtime: document.getElementById('overtime').value,
        daysAvailable: getDays(),
        stick: document.getElementById('stick').value,
        license: document.getElementById('license').value,
        company: document.getElementById('company').value.trim(),
        jobTitle: document.getElementById('jobTitle').value.trim(),
        companyPhone: document.getElementById('companyPhone').value.trim(),
        contactRef: document.getElementById('contactRef').value,
        notes: document.getElementById('notes').value.trim(),
        termsAccepted: document.getElementById('terms').checked,
        signature: signaturePad.isEmpty() ? "" : signaturePad.toDataURL("image/png"),
        submittedAt: new Date().toISOString(),
        userAgent: navigator.userAgent
      };

      // Basic required validation
      const required = ["name","email","phone","position","street","city","state","zip","eligible","startDate","employmentType","hoursPerWeek","overtime"];
      for (const k of required){
        if (!payload[k]) { alert("Please fill out all required fields."); return; }
      }
      if (payload.daysAvailable.length === 0){ alert("Please select at least one day available."); return; }
      if (!payload.termsAccepted){ alert("You must accept the terms."); return; }
      if (!payload.signature){ alert("Signature is required."); return; }

      statusEl.textContent = "Submitting...";

      try{
        const res = await fetch("/api/submit", {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        const out = await res.json();
        if (!out.ok) throw new Error(out.error || "submit_failed");

        statusEl.textContent = "Submitted successfully ✅";
        alert("Application submitted! Thank you.");
      }catch(err){
        console.error(err);
        statusEl.textContent = "Error submitting. Please try again.";
        alert("Error submitting. Please try again.");
      }
    }
  </script>
</body>
</html>
