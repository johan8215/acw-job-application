<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Allston Car Wash — Job Application</title>

  <style>
    :root{
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --brand:#1e3a8a;      /* header */
      --brand2:#2563eb;     /* button */
      --danger:#b91c1c;
      --ok:#16a34a;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --radius:16px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    .header{
      background: linear-gradient(90deg, #0b2a6f, var(--brand));
      color:#fff;
      padding: 22px 18px;
    }
    .header-inner{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
    }
    .brand h1{
      margin:0;
      font-size: 28px;
      line-height: 1.15;
      letter-spacing:.2px;
    }
    .brand p{
      margin:6px 0 0;
      opacity:.9;
      font-size:14px;
    }

    .lang{
      display:flex;
      gap:10px;
      align-items:center;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.22);
      padding:10px 12px;
      border-radius: 999px;
      user-select:none;
      white-space:nowrap;
    }
    .lang small{ opacity:.85; }
    .pill{
      display:flex;
      overflow:hidden;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
    }
    .pill button{
      appearance:none;
      border:0;
      background:transparent;
      color:#fff;
      padding:8px 10px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      opacity:.8;
    }
    .pill button.active{
      background: rgba(255,255,255,.18);
      opacity:1;
    }

    .wrap{
      max-width: 980px;
      margin: 18px auto 60px;
      padding: 0 14px;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card-top{
      padding: 18px 18px 10px;
      border-bottom: 1px solid var(--line);
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .card-top .title{
      font-size:18px;
      margin:0;
    }
    .card-top .hint{
      margin:4px 0 0;
      color: var(--muted);
      font-size:13px;
    }

    form{
      padding: 18px;
    }

    .section{
      margin-top: 18px;
      padding-top: 18px;
      border-top: 1px dashed var(--line);
    }
    .section:first-child{
      margin-top:0;
      padding-top:0;
      border-top:0;
    }

    .section h3{
      margin:0 0 12px;
      font-size:16px;
    }

    .grid{
      display:grid;
      gap:12px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .req::after{
      content:" *";
      color: var(--danger);
      font-weight: 800;
    }

    input, select, textarea{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 11px 12px;
      font-size: 15px;
      outline: none;
      background:#fff;
    }
    textarea{ min-height: 92px; resize: vertical; }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }
    .help{
      margin-top:6px;
      color: var(--muted);
      font-size:12px;
    }

    .row{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    .checks{
      display:grid;
      gap:10px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width: 760px){
      .checks{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    .check{
      display:flex;
      gap:10px;
      align-items:center;
      border: 1px solid var(--line);
      background:#fff;
      border-radius: 12px;
      padding: 10px 12px;
    }
    .check input{
      width: 18px;
      height: 18px;
      margin:0;
    }
    .check span{
      font-size: 14px;
      font-weight: 600;
    }

    .terms{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      background:#fff;
    }
    .terms input{
      width:20px; height:20px; margin-top:2px;
    }
    .terms p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .sig-wrap{
      border:1px dashed #cbd5e1;
      border-radius: 14px;
      padding: 12px;
      background:#fff;
    }
    canvas{
      width: 100%;
      height: 180px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      display:block;
      touch-action:none; /* IMPORTANT for iPad */
      background:#fff;
    }
    .sig-actions{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border:0;
      cursor:pointer;
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 800;
      font-size: 15px;
      width:100%;
    }
    .btn.primary{
      background: linear-gradient(90deg, var(--brand2), #1d4ed8);
      color:#fff;
      box-shadow: 0 10px 18px rgba(37,99,235,.18);
    }
    .btn.ghost{
      background:#eef2ff;
      color:#1e3a8a;
      width:auto;
      font-weight:800;
    }
    .btn.danger{
      background:#f1f5f9;
      color:#0f172a;
      width:auto;
    }

    .bar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-top: 16px;
      flex-wrap:wrap;
    }

    .status{
      font-size: 13px;
      color: var(--muted);
    }
    .status.ok{ color: var(--ok); font-weight:800; }
    .status.err{ color: var(--danger); font-weight:800; }

    .small{
      font-size: 12px;
      color: var(--muted);
    }

    .footer-note{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <h1 data-i18n="title">Allston Car Wash</h1>
        <p data-i18n="subtitle">Job Application Form • Please complete all required fields. Terms acceptance and a signature are required.</p>
      </div>

      <div class="lang">
        <small data-i18n="langLabel">Language</small>
        <div class="pill">
          <button type="button" id="btnEN" class="active">EN</button>
          <button type="button" id="btnES">ES</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <div class="card-top">
        <div>
          <p class="title" data-i18n="formTitle">Application</p>
          <p class="hint" data-i18n="formHint">Fields marked with * are required.</p>
        </div>
        <div class="small" id="buildInfo"></div>
      </div>

      <form id="appForm" novalidate>
        <!-- SECTION: Applicant -->
        <div class="section">
          <h3 data-i18n="secApplicant">Applicant Information</h3>
          <div class="grid">
            <div>
              <label class="req" for="name" data-i18n="fullName">Full Name</label>
              <input id="name" name="name" type="text" placeholder="First and last name" required />
            </div>

            <div>
              <label class="req" for="email" data-i18n="email">Email</label>
              <input id="email" name="email" type="email" placeholder="example@email.com" required />
            </div>

            <div>
              <label class="req" for="phone" data-i18n="phone">Phone</label>
              <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="(###) ###-####" required />
            </div>

            <div>
              <label class="req" for="position" data-i18n="position">Position Applying For</label>
              <select id="position" name="position" required>
                <option value="" selected disabled data-i18n="selectOne">Select one</option>
                <option value="Cashier">Cashier</option>
                <option value="Detailer">Detailer</option>
                <option value="Car Wash Attendant">Car Wash Attendant</option>
                <option value="Supervisor">Supervisor</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
        </div>

        <!-- SECTION: Address -->
        <div class="section">
          <h3 data-i18n="secAddress">Address</h3>
          <div class="grid">
            <div>
              <label class="req" for="street" data-i18n="street">Street Address</label>
              <input id="street" name="street" type="text" placeholder="Street address" required />
            </div>

            <div>
              <label class="req" for="city" data-i18n="city">City</label>
              <input id="city" name="city" type="text" placeholder="City" required />
            </div>

            <div>
              <label class="req" for="state" data-i18n="state">State</label>
              <input id="state" name="state" type="text" placeholder="MA" required />
            </div>

            <div>
              <label class="req" for="zip" data-i18n="zip">Zip Code</label>
              <input id="zip" name="zip" type="text" inputmode="numeric" placeholder="#####"
                     pattern="\\d{5}(-\\d{4})?" required />
              <div class="help" data-i18n="zipHelp">5 digits (or ZIP+4).</div>
            </div>
          </div>
        </div>

        <!-- SECTION: Eligibility & Availability -->
        <div class="section">
          <h3 data-i18n="secEligibility">Work Eligibility & Availability</h3>
          <div class="grid">
            <div>
              <label class="req" for="eligible" data-i18n="eligible">Legally eligible to work in the U.S.?</label>
              <select id="eligible" name="eligible" required>
                <option value="" selected disabled data-i18n="selectOne">Select one</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </div>

            <div>
              <label class="req" for="startDate" data-i18n="startDate">Available Start Date</label>
              <input id="startDate" name="startDate" type="date" required />
            </div>

            <div>
              <label class="req" for="workPermit" data-i18n="workPermit">If under 18 (if required), can you provide a work permit?</label>
              <select id="workPermit" name="workPermit" required>
                <option value="" selected disabled data-i18n="selectOne">Select one</option>
                <option>Yes</option>
                <option>No</option>
                <option>N/A</option>
              </select>
            </div>

            <div>
              <label class="req" for="employmentType" data-i18n="employmentType">Type of employment desired</label>
              <select id="employmentType" name="employmentType" required>
                <option value="" selected disabled data-i18n="selectOne">Select one</option>
                <option>Full time</option>
                <option>Part time</option>
                <option>Either</option>
              </select>
            </div>

            <div>
              <label class="req" for="hoursPerWeek" data-i18n="hoursPerWeek">Hours per week you are willing to work</label>
              <input id="hoursPerWeek" name="hoursPerWeek" type="number" min="1" max="80" placeholder="e.g., 40" required />
            </div>

            <div>
              <label class="req" for="overtime" data-i18n="overtime">Will you work overtime if required?</label>
              <select id="overtime" name="overtime" required>
                <option value="" selected disabled data-i18n="selectOne">Select one</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </div>
          </div>

          <div style="margin-top:14px;">
            <label class="req" data-i18n="daysAvailable">Days available to work</label>
            <div class="checks" id="daysBox">
              <label class="check"><input type="checkbox" value="Monday" /> <span data-i18n="mon">Monday</span></label>
              <label class="check"><input type="checkbox" value="Tuesday" /> <span data-i18n="tue">Tuesday</span></label>
              <label class="check"><input type="checkbox" value="Wednesday" /> <span data-i18n="wed">Wednesday</span></label>
              <label class="check"><input type="checkbox" value="Thursday" /> <span data-i18n="thu">Thursday</span></label>
              <label class="check"><input type="checkbox" value="Friday" /> <span data-i18n="fri">Friday</span></label>
              <label class="check"><input type="checkbox" value="Saturday" /> <span data-i18n="sat">Saturday</span></label>
              <label class="check"><input type="checkbox" value="Sunday" /> <span data-i18n="sun">Sunday</span></label>
            </div>
            <div class="help" data-i18n="daysHelp">Select at least one day.</div>
          </div>
        </div>

        <!-- SECTION: Driving -->
        <div class="section">
          <h3 data-i18n="secDriving">Driving (if applicable)</h3>
          <div class="grid">
            <div>
              <label for="stick" data-i18n="stick">Can you drive a standard (stick shift) car?</label>
              <select id="stick" name="stick">
                <option value="" selected data-i18n="selectOneOpt">Select one (optional)</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </div>

            <div>
              <label for="license" data-i18n="license">Do you have a valid U.S. Driver’s License?</label>
              <select id="license" name="license">
                <option value="" selected data-i18n="selectOneOpt">Select one (optional)</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </div>
          </div>
        </div>

        <!-- SECTION: Employment History -->
        <div class="section">
          <h3 data-i18n="secHistory">Employment History (Most Recent)</h3>
          <div class="grid">
            <div>
              <label for="company" data-i18n="company">Company Name</label>
              <input id="company" name="company" type="text" placeholder="Company" />
            </div>

            <div>
              <label for="jobTitle" data-i18n="jobTitle">Job Title</label>
              <input id="jobTitle" name="jobTitle" type="text" placeholder="Job title" />
            </div>

            <div>
              <label for="companyPhone" data-i18n="companyPhone">Company Phone</label>
              <input id="companyPhone" name="companyPhone" type="tel" inputmode="tel" placeholder="(###) ###-####" />
            </div>

            <div>
              <label for="contactRef" data-i18n="contactRef">May we contact for reference?</label>
              <select id="contactRef" name="contactRef">
                <option value="" selected data-i18n="selectOneOpt">Select one (optional)</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </div>
          </div>

          <div style="margin-top:12px;">
            <label for="notes" data-i18n="notes">Additional Notes (optional)</label>
            <textarea id="notes" name="notes" placeholder="Anything you want us to know…"></textarea>
          </div>
        </div>

        <!-- SECTION: Terms + Signature -->
        <div class="section">
          <h3 data-i18n="secTermsSig">Terms & Signature</h3>

          <div class="terms">
            <input id="termsAccepted" type="checkbox" />
            <p>
              <strong data-i18n="termsTitle">I agree</strong>
              <span data-i18n="termsText">to the Terms & Conditions and confirm the information provided is accurate.</span>
            </p>
          </div>

          <div style="margin-top:14px;">
            <label class="req" data-i18n="signature">Signature</label>
            <div class="sig-wrap">
              <canvas id="sig"></canvas>
              <div class="sig-actions">
                <button type="button" class="btn danger" id="clearSig" style="width:auto;" data-i18n="clearSig">Clear Signature</button>
              </div>
              <div class="help" data-i18n="sigHelp">Tip: Use your finger or Apple Pencil to sign.</div>
            </div>
          </div>

          <div class="bar">
            <div id="status" class="status" data-i18n="ready">Ready.</div>
            <div class="small" id="requiredNote"></div>
          </div>

          <button class="btn primary" type="submit" id="submitBtn" data-i18n="submit">Submit Application</button>

          <div class="footer-note" data-i18n="privacy">
            Your information will be used for hiring purposes only.
          </div>
        </div>
      </form>
    </div>
  </main>

  <script>
    // ---------- Simple i18n (EN/ES) ----------
    const i18n = {
      en: {
        title: "Allston Car Wash",
        subtitle: "Job Application Form • Please complete all required fields. Terms acceptance and a signature are required.",
        langLabel: "Language",
        formTitle: "Application",
        formHint: "Fields marked with * are required.",
        secApplicant: "Applicant Information",
        fullName: "Full Name",
        email: "Email",
        phone: "Phone",
        position: "Position Applying For",
        selectOne: "Select one",
        selectOneOpt: "Select one (optional)",
        secAddress: "Address",
        street: "Street Address",
        city: "City",
        state: "State",
        zip: "Zip Code",
        zipHelp: "5 digits (or ZIP+4).",
        secEligibility: "Work Eligibility & Availability",
        eligible: "Legally eligible to work in the U.S.?",
        startDate: "Available Start Date",
        workPermit: "If under 18 (if required), can you provide a work permit?",
        employmentType: "Type of employment desired",
        hoursPerWeek: "Hours per week you are willing to work",
        overtime: "Will you work overtime if required?",
        daysAvailable: "Days available to work",
        daysHelp: "Select at least one day.",
        mon:"Monday", tue:"Tuesday", wed:"Wednesday", thu:"Thursday", fri:"Friday", sat:"Saturday", sun:"Sunday",
        secDriving: "Driving (if applicable)",
        stick: "Can you drive a standard (stick shift) car?",
        license: "Do you have a valid U.S. Driver’s License?",
        secHistory: "Employment History (Most Recent)",
        company: "Company Name",
        jobTitle: "Job Title",
        companyPhone: "Company Phone",
        contactRef: "May we contact for reference?",
        notes: "Additional Notes (optional)",
        secTermsSig: "Terms & Signature",
        termsTitle: "I agree",
        termsText: "to the Terms & Conditions and confirm the information provided is accurate.",
        signature: "Signature",
        clearSig: "Clear Signature",
        sigHelp: "Tip: Use your finger or Apple Pencil to sign.",
        submit: "Submit Application",
        ready: "Ready.",
        privacy: "Your information will be used for hiring purposes only."
      },
      es: {
        title: "Allston Car Wash",
        subtitle: "Solicitud de Empleo • Completa todos los campos requeridos. Términos y firma son obligatorios.",
        langLabel: "Idioma",
        formTitle: "Solicitud",
        formHint: "Los campos con * son obligatorios.",
        secApplicant: "Información del Solicitante",
        fullName: "Nombre Completo",
        email: "Correo",
        phone: "Teléfono",
        position: "Posición a la que Aplica",
        selectOne: "Elige una opción",
        selectOneOpt: "Elige una opción (opcional)",
        secAddress: "Dirección",
        street: "Dirección",
        city: "Ciudad",
        state: "Estado",
        zip: "Código Postal",
        zipHelp: "5 dígitos (o ZIP+4).",
        secEligibility: "Elegibilidad y Disponibilidad",
        eligible: "¿Legalmente autorizado para trabajar en EE.UU.?",
        startDate: "Fecha Disponible para Empezar",
        workPermit: "Si es menor de 18 (si aplica), ¿puede proveer permiso de trabajo?",
        employmentType: "Tipo de empleo deseado",
        hoursPerWeek: "Horas por semana que desea trabajar",
        overtime: "¿Trabajaría horas extra si se requiere?",
        daysAvailable: "Días disponibles para trabajar",
        daysHelp: "Seleccione al menos un día.",
        mon:"Lunes", tue:"Martes", wed:"Miércoles", thu:"Jueves", fri:"Viernes", sat:"Sábado", sun:"Domingo",
        secDriving: "Manejo (si aplica)",
        stick: "¿Puede manejar transmisión manual (stick shift)?",
        license: "¿Tiene licencia de conducir válida en EE.UU.?",
        secHistory: "Historial de Empleo (Más Reciente)",
        company: "Nombre de la Empresa",
        jobTitle: "Cargo",
        companyPhone: "Teléfono de la Empresa",
        contactRef: "¿Podemos contactar como referencia?",
        notes: "Notas adicionales (opcional)",
        secTermsSig: "Términos y Firma",
        termsTitle: "Acepto",
        termsText: "los Términos y Condiciones y confirmo que la información es correcta.",
        signature: "Firma",
        clearSig: "Borrar Firma",
        sigHelp: "Tip: Use su dedo o Apple Pencil para firmar.",
        submit: "Enviar Solicitud",
        ready: "Listo.",
        privacy: "Su información se usará solo para fines de contratación."
      }
    };

    let currentLang = "en";
    const btnEN = document.getElementById("btnEN");
    const btnES = document.getElementById("btnES");

    function applyLang(lang){
      currentLang = lang;
      btnEN.classList.toggle("active", lang === "en");
      btnES.classList.toggle("active", lang === "es");

      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        if (i18n[lang] && i18n[lang][key]) el.textContent = i18n[lang][key];
      });
    }

    btnEN.addEventListener("click", ()=> applyLang("en"));
    btnES.addEventListener("click", ()=> applyLang("es"));
    applyLang("en");

    // ---------- Signature Canvas (iPad-safe) ----------
    const canvas = document.getElementById("sig");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    let hasInk = false;

    function resizeCanvas(){
      // Keep crisp on Retina screens
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.floor(rect.width * ratio);
      canvas.height = Math.floor(rect.height * ratio);
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      ctx.lineWidth = 3;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = "#0f172a";
    }

    window.addEventListener("resize", resizeCanvas);
    setTimeout(resizeCanvas, 50);

    function pointFromEvent(e){
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches && e.touches[0];
      const clientX = touch ? touch.clientX : e.clientX;
      const clientY = touch ? touch.clientY : e.clientY;
      return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function startDraw(e){
      e.preventDefault();
      drawing = true;
      const p = pointFromEvent(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
    }

    function moveDraw(e){
      if (!drawing) return;
      e.preventDefault();
      const p = pointFromEvent(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      hasInk = true;
    }

    function endDraw(e){
      if (!drawing) return;
      e.preventDefault();
      drawing = false;
    }

    canvas.addEventListener("mousedown", startDraw);
    canvas.addEventListener("mousemove", moveDraw);
    window.addEventListener("mouseup", endDraw);

    canvas.addEventListener("touchstart", startDraw, { passive:false });
    canvas.addEventListener("touchmove", moveDraw, { passive:false });
    canvas.addEventListener("touchend", endDraw, { passive:false });

    document.getElementById("clearSig").addEventListener("click", ()=>{
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasInk = false;
      setStatus(i18n[currentLang].ready);
    });

    function signatureDataURL(){
      // Make sure canvas is not empty
      if (!hasInk) return "";
      return canvas.toDataURL("image/png");
    }

    // ---------- Form submit ----------
    const form = document.getElementById("appForm");
    const statusEl = document.getElementById("status");
    const submitBtn = document.getElementById("submitBtn");
    const buildInfo = document.getElementById("buildInfo");

    buildInfo.textContent = "Build: " + new Date().toLocaleString();

    function setStatus(msg, kind=""){
      statusEl.classList.remove("ok","err");
      if (kind) statusEl.classList.add(kind);
      statusEl.textContent = msg;
    }

    function getDays(){
      return Array.from(document.querySelectorAll("#daysBox input[type=checkbox]:checked")).map(x=>x.value);
    }

    function validate(){
      // Required basic fields
      const requiredIds = ["name","email","phone","position","street","city","state","zip","eligible","startDate","workPermit","employmentType","hoursPerWeek","overtime"];
      for (const id of requiredIds){
        const el = document.getElementById(id);
        if (!el.value || !String(el.value).trim()){
          el.focus();
          return { ok:false, msg:`Please fill out all required fields. (${id})` };
        }
      }

      // zip pattern
      const zip = document.getElementById("zip").value.trim();
      const zipOk = /^\d{5}(-\d{4})?$/.test(zip);
      if (!zipOk){
        document.getElementById("zip").focus();
        return { ok:false, msg:"Zip Code is not valid." };
      }

      // days at least one
      const days = getDays();
      if (!days.length){
        return { ok:false, msg:"Please select at least one day available to work." };
      }

      // terms
      const termsAccepted = document.getElementById("termsAccepted").checked;
      if (!termsAccepted){
        return { ok:false, msg:"You must accept the Terms & Conditions." };
      }

      // signature
      const sig = signatureDataURL();
      if (!sig){
        return { ok:false, msg:"Signature is required." };
      }

      return { ok:true, days, sig };
    }

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();

      const v = validate();
      if (!v.ok){
        setStatus(v.msg, "err");
        alert(v.msg);
        return;
      }

      submitBtn.disabled = true;
      submitBtn.style.opacity = "0.85";
      setStatus("Submitting…");

      const payload = {
        // required
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        position: document.getElementById("position").value,
        street: document.getElementById("street").value.trim(),
        city: document.getElementById("city").value.trim(),
        state: document.getElementById("state").value.trim(),
        zip: document.getElementById("zip").value.trim(),
        eligible: document.getElementById("eligible").value,
        startDate: document.getElementById("startDate").value,
        workPermit: document.getElementById("workPermit").value,
        employmentType: document.getElementById("employmentType").value,
        hoursPerWeek: document.getElementById("hoursPerWeek").value,
        overtime: document.getElementById("overtime").value,
        daysAvailable: v.days,
        termsAccepted: true,
        signature: v.sig,

        // optional
        stick: document.getElementById("stick").value,
        license: document.getElementById("license").value,
        company: document.getElementById("company").value.trim(),
        jobTitle: document.getElementById("jobTitle").value.trim(),
        companyPhone: document.getElementById("companyPhone").value.trim(),
        contactRef: document.getElementById("contactRef").value,
        notes: document.getElementById("notes").value.trim(),

        // metadata
        submittedAt: new Date().toISOString(),
        lang: currentLang
      };

      try{
        const r = await fetch("/api/submit", {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        const text = await r.text();
        let json = null;
        try{ json = JSON.parse(text); }catch(_){}

        if (!r.ok || (json && json.ok === false)){
          const errMsg = (json && json.error) ? String(json.error) : (text || "Unknown error");
          throw new Error(errMsg);
        }

        setStatus("Submitted successfully!", "ok");
        alert("Submitted successfully!");

        // optional: reset
        form.reset();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hasInk = false;

      }catch(err){
        console.error(err);
        const msg = "Submit failed: " + (err && err.message ? err.message : "Unknown error");
        setStatus(msg, "err");
        alert(msg);
      }finally{
        submitBtn.disabled = false;
        submitBtn.style.opacity = "1";
      }
    });
  </script>
</body>
</html>
